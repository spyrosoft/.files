source ~/.zsh-create-user-custom
# Aliases automatically created during the user creation process
source ~/.alias

alias zsh-template="e ~/templates/.zshrc"
alias emacs-template="e ~/templates/.emacs"

alias edit-haproxy="e -nw /etc/haproxy/haproxy.cfg"

# Check the configuration file - when successful restart the service
alias restart-haproxy="haproxy -c -f /etc/haproxy/haproxy.cfg && systemctl restart haproxy && systemctl status haproxy"



function create-letsencrypt-cert() {
	if [[ $# -ne 2 ]]; then
		echo "Usage: $0 EMAIL-USER-NAME FLAT-DOMAIN"
		echo "For example: $0 admin firefractal.com"
		return
	fi
	systemctl stop haproxy && letsencrypt certonly --email $1@$2 -d $2 -d www.$2
	cp /etc/haproxy/certs/$2.pem /tmp/
	cat /etc/letsencrypt/live/$2/fullchain.pem /etc/letsencrypt/live/$2/privkey.pem > /etc/haproxy/certs/$2.pem
	systemctl start haproxy
}

function set-root-permissions() {
	find /root -exec chmod o-rwx {} +
}

function pull-site() {
	cd /home/$1/hunchentoot
	git pull
	set-user-permissions $1 $1
}

function pull-firefractal() {
	cd /home/firefractal/hunchentoot
	git pull
	set-user-permissions firefractal firefractal
}

function pull-groundupmath() {
	cd /home/groundupmath/hunchentoot
	git pull
	cd /home/groundupmath/hunchentoot/static
	git pull
	set-groundupmath-permissions
}

function pull-chaosofoperations() {
	cd /home/chaosofoperations/hunchentoot
	git pull
	cd /home/chaosofoperations/hunchentoot/static
	git pull
	set-chaosofoperations-permissions
}

function set-user-permissions() {
	if [[ $# -ne 2 ]]; then
		echo "Usage: set-user-permissions USERNAME DOMAIN"
		return
	fi
	find ~$1 -type f -exec chmod 640 {} +
	find ~$1 -type d -exec chmod 750 {} +
	chmod 750 /home/$1/go/src/generate-mandelbrot-png/generate-mandelbrot-png
	
	chown -R root:$1 /home/$1
	chown $1:$1 /home/$1
	chown -R $1:$1 /home/$1/.cache \
		/home/$1/hunchentoot/logs/access.log \
		/home/$1/hunchentoot/logs/error.log \
		/home/$1/.histfile \
		/home/$1/hunchentoot/generate-png-queue \
		/home/$1/hunchentoot/static/images/fractals
}

prompt_color="blue"
prompt_prefix="="